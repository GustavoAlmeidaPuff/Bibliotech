MUDANÇAS NECESSÁRIAS NAS REGRAS DO FIREBASE
===========================================

Suas regras atuais estão quase corretas! Você só precisa alterar 2 linhas específicas:

🔧 MUDANÇA 1: Permitir leitura pública dos EMPRÉSTIMOS
======================================================

ATUAL (linha ~35):
    match /users/{userId}/loans/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

NOVO:
    match /users/{userId}/loans/{document=**} {
      allow read: if true; // 🆕 MUDANÇA: Permite leitura pública dos empréstimos
      allow write: if request.auth != null && request.auth.uid == userId;
    }

🔧 MUDANÇA 2: Permitir leitura pública dos LIVROS
=================================================

ATUAL (linha ~31):
    match /users/{userId}/books/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

NOVO:
    match /users/{userId}/books/{document=**} {
      allow read: if true; // 🆕 MUDANÇA: Permite leitura pública dos livros
      allow write: if request.auth != null && request.auth.uid == userId;
    }

📋 REGRAS FINAIS COMPLETAS
==========================

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Regra para permitir leitura de metadados dos usuários (necessário para listar usuários)
    match /users/{userId} {
      allow read: if true; // Permite leitura dos documentos de usuário para buscar bibliotecas
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Regra específica para permitir leitura pública dos dados dos alunos
    match /users/{userId}/students/{studentId} {
      allow read: if true; // Permite leitura pública dos dados dos alunos
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Permitir leitura pública das coleções students (para listar)
    match /users/{userId}/students {
      allow read: if true; // Permite listar alunos
    }
    
    // 🆕 MUDANÇA: Regras para livros - agora com leitura pública
    match /users/{userId}/books/{document=**} {
      allow read: if true; // 🆕 NOVA: Permite leitura pública dos livros
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // 🆕 MUDANÇA: Regras para empréstimos - agora com leitura pública
    match /users/{userId}/loans/{document=**} {
      allow read: if true; // 🆕 NOVA: Permite leitura pública dos empréstimos
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Regras restritivas para outros documentos dos usuários (SEM MUDANÇA)
    match /users/{userId}/staff/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    match /users/{userId}/classes/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    match /users/{userId}/settings/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Regra para notificações globais - apenas admin pode escrever (SEM MUDANÇA)
    match /globalNotifications/{document=**} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.token.email == 'admin@admin.com';
    }
    
    // Regra para dados públicos - todos podem ler, apenas usuários autenticados podem escrever (SEM MUDANÇA)
    match /publicData/{document=**} {
      allow read: if true; // Qualquer um pode ler dados públicos
      allow write: if request.auth != null; // Apenas usuários autenticados podem escrever
    }
  }
}

✅ RESUMO DAS MUDANÇAS
======================

Você só precisa mudar 2 linhas:

1️⃣ Na seção de books: `allow read, write: if request.auth != null && request.auth.uid == userId;`
   PARA: `allow read: if true; allow write: if request.auth != null && request.auth.uid == userId;`

2️⃣ Na seção de loans: `allow read, write: if request.auth != null && request.auth.uid == userId;`
   PARA: `allow read: if true; allow write: if request.auth != null && request.auth.uid == userId;`

🔒 SEGURANÇA MANTIDA
====================

✅ Escrita (write) ainda requer autenticação
✅ Staff, classes e settings continuam protegidos
✅ Apenas leitura (read) de books e loans ficou pública
✅ Aluno precisa saber o ID específico para acessar

🚀 APÓS APLICAR
===============

1. Copie as regras finais acima
2. Cole no Firebase Console > Firestore > Rules
3. Clique em "Publish"
4. Teste o dashboard do aluno
